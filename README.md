# Modbus Client

Клиент Modbus RTU на Python для чтения данных с устройств Modbus и записи информации в файл.

## Обзор

Это приложение подключается к устройству Modbus через последовательное соединение (протокол RTU) и непрерывно считывает holding-регистры. Данные обрабатываются и записываются в файл с метками времени.

Реализация включает чтение значения регистра, преобразование его в инженерные единицы (toc и P_kg) и сохранение результатов.

## Особенности

- Подключение к устройствам Modbus через последовательный протокол RTU
- Непрерывный опрос регистров устройства с заданным интервалом
- Обработка сырых значений регистров в инженерные единицы
- Запись данных в текстовый файл с метками времени
- Корректное завершение работы по сигналу Ctrl+C

## Требования

- Python 3.x
- Библиотека pymodbus

Установите необходимые зависимости с помощью:
```bash
pip install pymodbus
```

## Конфигурация

Следующие параметры можно настроить в файле [ModbusClient.py](file:///c%3A/Users/RGG/Desktop/Calculate/Modbus/ModbusClient.py):

- `PORT`: Последовательный порт для подключения (например, "COM1", "/dev/ttyUSB0")
- `BAUDRATE`: Скорость передачи данных (по умолчанию: 9600)
- `PARITY`: Параметр четности (по умолчанию: "N" - без четности)
- `BYTESIZE`: Количество бит данных (по умолчанию: 8)
- `STOPBITS`: Количество стоп-бит (по умолчанию: 1)
- `TIMEOUT`: Таймаут соединения в секундах (по умолчанию: 1)
- `SLAVE_ID`: ID ведомого устройства Modbus (по умолчанию: 2)
- `REGISTER_ADDRESS`: Начальный адрес регистра для чтения (по умолчанию: 0)
- `COUNT`: Количество регистров для чтения (по умолчанию: 1)
- `POLLING_INTERVAL`: Интервал между запросами в секундах (по умолчанию: 0.5)

## Использование

1. Подключите устройство Modbus к компьютеру через последовательный интерфейс (при необходимости используйте преобразователь RS485/RS232 в USB)
2. Настройте параметры подключения в скрипте в соответствии с вашим устройством
3. Запустите скрипт:

```bash
python ModbusClient.py
```

4. Приложение выполнит следующие действия:
   - Подключится к указанному последовательному порту
   - Начнет опрос устройства Modbus
   - Отобразит значения регистров в сыром и преобразованном виде
   - Сохранит данные в файл `modbus_data.txt`
   - Будет продолжать работу до остановки по Ctrl+C

## Обработка данных

Приложение читает сыroe 16-битное значение регистра и преобразует его в две инженерные единицы:
1. Значение `toc` вычисляется по формуле: `((16.0 * raw_value) / 65535.0) + 4.0`
2. Значение `P_kg` вычисляется по формуле: `((toc - 4) * (163 - 5)) / (16.0)`

## Вывод данных

Приложение выводит данные в двух местах:
1. Консоль: Отображение значений регистров и статуса в реальном времени
2. Файл: `modbus_data.txt` содержит данные с метками времени в формате:
   ```
   [ГГГГ-ММ-ДД ЧЧ:ММ:СС] toc = X.XXX, P_kg = Y.YYY
   ```

## Остановка приложения

Нажмите `Ctrl+C` для корректной остановки опроса и закрытия соединения.

## Лицензия

Этот проект является открытым исходным кодом и доступен по лицензии MIT.